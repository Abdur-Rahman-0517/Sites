<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Code Editor with Folder Structure</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    <style>
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #3498db;
            --accent-color: #e74c3c;
            --light-color: #ecf0f1;
            --dark-color: #34495e;
            --success-color: #2ecc71;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #1e272e;
            color: var(--light-color);
            line-height: 1.6;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            display: flex;
            flex-direction: column;
            height: 100vh;
        }
        
        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
            border-bottom: 1px solid var(--dark-color);
            margin-bottom: 20px;
        }
        
        .logo {
            font-size: 1.8rem;
            font-weight: bold;
            color: var(--secondary-color);
        }
        
        .controls {
            display: flex;
            gap: 10px;
        }
        
        button {
            background-color: var(--secondary-color);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s;
            font-weight: 500;
        }
        
        button:hover {
            background-color: #2980b9;
        }
        
        button.danger {
            background-color: var(--accent-color);
        }
        
        button.danger:hover {
            background-color: #c0392b;
        }
        
        button.success {
            background-color: var(--success-color);
        }
        
        button.success:hover {
            background-color: #27ae60;
        }
        
        .main-content {
            display: flex;
            flex: 1;
            gap: 20px;
            overflow: hidden;
        }
        
        .sidebar {
            width: 300px;
            background-color: var(--dark-color);
            border-radius: 8px;
            padding: 15px;
            overflow-y: auto;
        }
        
        .editor-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            background-color: var(--dark-color);
            border-radius: 8px;
            overflow: hidden;
        }
        
        .file-explorer {
            margin-bottom: 20px;
        }
        
        .file-explorer h3 {
            margin-bottom: 10px;
            color: var(--secondary-color);
        }
        
        .folder-structure {
            list-style-type: none;
            padding-left: 10px;
        }
        
        .folder-structure li {
            margin: 5px 0;
            cursor: pointer;
            padding: 5px;
            border-radius: 4px;
            display: flex;
            align-items: center;
        }
        
        .folder-structure li:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }
        
        .folder-structure li.active {
            background-color: rgba(52, 152, 219, 0.3);
        }
        
        .folder-icon, .file-icon {
            margin-right: 8px;
            font-size: 1.2rem;
        }
        
        .editor-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 15px;
            background-color: var(--primary-color);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .file-name {
            font-weight: 500;
            font-size: 1.1rem;
        }
        
        .editor {
            flex: 1;
            display: flex;
            flex-direction: column;
        }
        
        textarea {
            flex: 1;
            background-color: #263238;
            color: var(--light-color);
            border: none;
            padding: 15px;
            resize: none;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.5;
        }
        
        textarea:focus {
            outline: none;
        }
        
        .status-bar {
            padding: 8px 15px;
            background-color: var(--primary-color);
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            justify-content: space-between;
            font-size: 0.9rem;
            color: #95a5a6;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        
        .modal-content {
            background-color: var(--dark-color);
            padding: 25px;
            border-radius: 8px;
            width: 400px;
            max-width: 90%;
        }
        
        .modal h3 {
            margin-bottom: 15px;
            color: var(--secondary-color);
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
        }
        
        .form-group input {
            width: 100%;
            padding: 8px 10px;
            border-radius: 4px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            background-color: rgba(255, 255, 255, 0.1);
            color: white;
        }
        
        .form-group input:focus {
            outline: none;
            border-color: var(--secondary-color);
        }
        
        .modal-buttons {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-top: 20px;
        }
        
        .file-count {
            color: #95a5a6;
            font-size: 0.9rem;
        }
        
        .empty-state {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100%;
            text-align: center;
            padding: 20px;
        }
        
        .empty-state h3 {
            margin-bottom: 10px;
            color: var(--secondary-color);
        }
        
        .empty-state p {
            color: #95a5a6;
            margin-bottom: 20px;
        }
        
        .breadcrumb {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
            font-size: 0.9rem;
        }
        
        .breadcrumb-item {
            cursor: pointer;
            color: var(--secondary-color);
        }
        
        .breadcrumb-item:hover {
            text-decoration: underline;
        }
        
        .breadcrumb-separator {
            margin: 0 8px;
            color: #95a5a6;
        }
        
        .context-menu {
            position: absolute;
            background-color: var(--dark-color);
            border-radius: 4px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
            z-index: 100;
            display: none;
        }
        
        .context-menu-item {
            padding: 8px 15px;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        
        .context-menu-item:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }
        
        .auto-save-indicator {
            color: var(--success-color);
            font-size: 0.8rem;
            margin-left: 10px;
        }
        
        .search-box {
            margin-bottom: 15px;
        }
        
        .search-box input {
            width: 100%;
            padding: 8px 10px;
            border-radius: 4px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            background-color: rgba(255, 255, 255, 0.1);
            color: white;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="logo">Code Editor</div>
            <div class="controls">
                <button id="newFolderBtn">New Folder</button>
                <button id="newFileBtn">New File</button>
                <button id="downloadBtn" class="success">Download as ZIP</button>
                <button id="clearAllBtn" class="danger">Clear All</button>
            </div>
        </header>
        
        <div class="main-content">
            <div class="sidebar">
                <div class="file-explorer">
                    <h3>File Explorer</h3>
                    <div class="search-box">
                        <input type="text" id="searchInput" placeholder="Search files...">
                    </div>
                    <div class="breadcrumb" id="breadcrumb">
                        <span class="breadcrumb-item" data-id="root">Root</span>
                    </div>
                    <ul class="folder-structure" id="folderStructure">
                        <!-- Folder structure will be populated here -->
                    </ul>
                </div>
                <div class="file-count" id="fileCount">Files: <span id="fileCountValue">0</span></div>
            </div>
            
            <div class="editor-container">
                <div class="editor-header">
                    <div class="file-name" id="fileName">No file selected <span class="auto-save-indicator" id="autoSaveIndicator">Auto-saved</span></div>
                    <div>
                        <button id="saveFileBtn">Save File</button>
                        <button id="deleteFileBtn" class="danger">Delete File</button>
                    </div>
                </div>
                <div class="editor">
                    <textarea id="codeEditor" placeholder="Select a file to edit or create a new file..." spellcheck="false"></textarea>
                </div>
                <div class="status-bar">
                    <div>Total files: <span id="totalFiles">0</span></div>
                    <div>Current file: <span id="currentFileInfo">None</span></div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- New Folder Modal -->
    <div class="modal" id="folderModal">
        <div class="modal-content">
            <h3>Create New Folder</h3>
            <div class="form-group">
                <label for="folderName">Folder Name</label>
                <input type="text" id="folderName" placeholder="Enter folder name">
            </div>
            <div class="modal-buttons">
                <button id="cancelFolderBtn">Cancel</button>
                <button id="createFolderBtn" class="success">Create</button>
            </div>
        </div>
    </div>
    
    <!-- New File Modal -->
    <div class="modal" id="fileModal">
        <div class="modal-content">
            <h3>Create New File</h3>
            <div class="form-group">
                <label for="fileNameInput">File Name (with extension)</label>
                <input type="text" id="fileNameInput" placeholder="e.g., index.html, script.js, style.css">
            </div>
            <div class="modal-buttons">
                <button id="cancelFileBtn">Cancel</button>
                <button id="createFileBtn" class="success">Create</button>
            </div>
        </div>
    </div>
    
    <!-- Context Menu -->
    <div class="context-menu" id="contextMenu">
        <div class="context-menu-item" data-action="rename">Rename</div>
        <div class="context-menu-item" data-action="delete">Delete</div>
    </div>

    <script>
        // Data structure to hold files and folders
        let fileSystem = {
            id: 'root',
            name: 'Root',
            type: 'folder',
            children: []
        };

        // Current state
        let currentFolder = fileSystem;
        let currentFile = null;
        let fileCount = 0;
        let contextMenuTarget = null;
        let autoSaveTimer = null;
        let searchTerm = '';

        // LocalStorage key
        const STORAGE_KEY = 'codeEditorFileSystem';

        // DOM elements
        const folderStructure = document.getElementById('folderStructure');
        const codeEditor = document.getElementById('codeEditor');
        const fileName = document.getElementById('fileName');
        const fileCountElement = document.getElementById('fileCountValue');
        const totalFilesElement = document.getElementById('totalFiles');
        const currentFileInfo = document.getElementById('currentFileInfo');
        const breadcrumb = document.getElementById('breadcrumb');
        const autoSaveIndicator = document.getElementById('autoSaveIndicator');
        const searchInput = document.getElementById('searchInput');
        
        // Modal elements
        const folderModal = document.getElementById('folderModal');
        const fileModal = document.getElementById('fileModal');
        const folderNameInput = document.getElementById('folderName');
        const fileNameInput = document.getElementById('fileNameInput');
        
        // Buttons
        const newFolderBtn = document.getElementById('newFolderBtn');
        const newFileBtn = document.getElementById('newFileBtn');
        const downloadBtn = document.getElementById('downloadBtn');
        const saveFileBtn = document.getElementById('saveFileBtn');
        const deleteFileBtn = document.getElementById('deleteFileBtn');
        const clearAllBtn = document.getElementById('clearAllBtn');
        const createFolderBtn = document.getElementById('createFolderBtn');
        const cancelFolderBtn = document.getElementById('cancelFolderBtn');
        const createFileBtn = document.getElementById('createFileBtn');
        const cancelFileBtn = document.getElementById('cancelFileBtn');
        
        // Context menu
        const contextMenu = document.getElementById('contextMenu');

        // Initialize the app
        function init() {
            loadFromLocalStorage();
            renderFolderStructure();
            updateFileCount();
            attachEventListeners();
            hideAutoSaveIndicator();
        }

        // Load file system from localStorage
        function loadFromLocalStorage() {
            const stored = localStorage.getItem(STORAGE_KEY);
            if (stored) {
                fileSystem = JSON.parse(stored);
                currentFolder = fileSystem;
                
                // Recreate parent references
                function recreateParentRefs(node, parent = null) {
                    node.parent = parent;
                    if (node.children) {
                        node.children.forEach(child => recreateParentRefs(child, node));
                    }
                }
                
                recreateParentRefs(fileSystem);
            }
        }

        // Save file system to localStorage
        function saveToLocalStorage() {
            // Remove parent references before saving to avoid circular references
            function removeParentRefs(node) {
                if (node.parent) {
                    delete node.parent;
                }
                if (node.children) {
                    node.children.forEach(child => removeParentRefs(child));
                }
                return node;
            }
            
            const fileSystemCopy = JSON.parse(JSON.stringify(fileSystem));
            removeParentRefs(fileSystemCopy);
            localStorage.setItem(STORAGE_KEY, JSON.stringify(fileSystemCopy));
            
            showAutoSaveIndicator();
        }

        // Show auto-save indicator
        function showAutoSaveIndicator() {
            autoSaveIndicator.style.display = 'inline';
            setTimeout(hideAutoSaveIndicator, 2000);
        }

        // Hide auto-save indicator
        function hideAutoSaveIndicator() {
            autoSaveIndicator.style.display = 'none';
        }

        // Attach event listeners
        function attachEventListeners() {
            newFolderBtn.addEventListener('click', () => {
                folderNameInput.value = '';
                folderModal.style.display = 'flex';
                folderNameInput.focus();
            });
            
            newFileBtn.addEventListener('click', () => {
                fileNameInput.value = '';
                fileModal.style.display = 'flex';
                fileNameInput.focus();
            });
            
            downloadBtn.addEventListener('click', downloadAsZip);
            saveFileBtn.addEventListener('click', saveCurrentFile);
            deleteFileBtn.addEventListener('click', deleteCurrentFile);
            clearAllBtn.addEventListener('click', clearAllFiles);
            
            createFolderBtn.addEventListener('click', createNewFolder);
            cancelFolderBtn.addEventListener('click', () => {
                folderModal.style.display = 'none';
            });
            
            createFileBtn.addEventListener('click', createNewFile);
            cancelFileBtn.addEventListener('click', () => {
                fileModal.style.display = 'none';
            });
            
            // Auto-save when typing in editor
            codeEditor.addEventListener('input', () => {
                if (currentFile) {
                    currentFile.content = codeEditor.value;
                    
                    // Debounce the save to localStorage
                    clearTimeout(autoSaveTimer);
                    autoSaveTimer = setTimeout(() => {
                        saveToLocalStorage();
                    }, 1000);
                }
            });
            
            // Search functionality
            searchInput.addEventListener('input', (e) => {
                searchTerm = e.target.value.toLowerCase();
                renderFolderStructure();
            });
            
            // Close modals when clicking outside
            window.addEventListener('click', (e) => {
                if (e.target === folderModal) {
                    folderModal.style.display = 'none';
                }
                if (e.target === fileModal) {
                    fileModal.style.display = 'none';
                }
            });
            
            // Context menu
            document.addEventListener('contextmenu', (e) => {
                if (e.target.closest('.folder-structure li')) {
                    e.preventDefault();
                    contextMenuTarget = e.target.closest('.folder-structure li');
                    showContextMenu(e.pageX, e.pageY);
                }
            });
            
            document.addEventListener('click', () => {
                hideContextMenu();
            });
            
            contextMenu.addEventListener('click', (e) => {
                if (e.target.dataset.action === 'rename') {
                    renameItem(contextMenuTarget);
                } else if (e.target.dataset.action === 'delete') {
                    deleteItem(contextMenuTarget);
                }
            });
            
            // Enter key in modals
            folderNameInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    createNewFolder();
                }
            });
            
            fileNameInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    createNewFile();
                }
            });
        }

        // Render the folder structure
        function renderFolderStructure() {
            folderStructure.innerHTML = '';
            
            let itemsToShow = currentFolder.children;
            
            // Filter by search term if provided
            if (searchTerm) {
                itemsToShow = itemsToShow.filter(item => 
                    item.name.toLowerCase().includes(searchTerm)
                );
            }
            
            if (itemsToShow.length === 0) {
                const emptyMsg = searchTerm ? 
                    'No files or folders match your search' : 
                    'This folder is empty';
                folderStructure.innerHTML = `<div class="empty-state"><p>${emptyMsg}</p></div>`;
                return;
            }
            
            itemsToShow.forEach(item => {
                const li = document.createElement('li');
                li.dataset.id = item.id;
                
                if (item.type === 'folder') {
                    li.innerHTML = `<span class="folder-icon">📁</span> ${item.name}`;
                    li.addEventListener('click', () => {
                        navigateToFolder(item);
                    });
                } else {
                    li.innerHTML = `<span class="file-icon">📄</span> ${item.name}`;
                    li.addEventListener('click', () => {
                        openFile(item);
                    });
                }
                
                folderStructure.appendChild(li);
            });
            
            updateBreadcrumb();
        }

        // Update breadcrumb navigation
        function updateBreadcrumb() {
            breadcrumb.innerHTML = '';
            
            // Build path from current folder to root
            const path = [];
            let folder = currentFolder;
            
            while (folder) {
                path.unshift(folder);
                folder = folder.parent;
            }
            
            // Create breadcrumb items
            path.forEach((item, index) => {
                const span = document.createElement('span');
                span.className = 'breadcrumb-item';
                span.textContent = item.name;
                span.dataset.id = item.id;
                
                span.addEventListener('click', () => {
                    if (item.id !== currentFolder.id) {
                        navigateToFolder(item);
                    }
                });
                
                breadcrumb.appendChild(span);
                
                if (index < path.length - 1) {
                    const separator = document.createElement('span');
                    separator.className = 'breadcrumb-separator';
                    separator.textContent = '>';
                    breadcrumb.appendChild(separator);
                }
            });
        }

        // Navigate to a folder
        function navigateToFolder(folder) {
            currentFolder = folder;
            currentFile = null;
            codeEditor.value = '';
            fileName.textContent = 'No file selected';
            currentFileInfo.textContent = 'None';
            renderFolderStructure();
        }

        // Create a new folder
        function createNewFolder() {
            const name = folderNameInput.value.trim();
            
            if (!name) {
                alert('Please enter a folder name');
                return;
            }
            
            // Check if folder already exists
            if (currentFolder.children.some(item => item.name === name && item.type === 'folder')) {
                alert('A folder with this name already exists');
                return;
            }
            
            const newFolder = {
                id: 'folder_' + Date.now(),
                name: name,
                type: 'folder',
                parent: currentFolder,
                children: []
            };
            
            currentFolder.children.push(newFolder);
            folderModal.style.display = 'none';
            renderFolderStructure();
            saveToLocalStorage();
        }

        // Create a new file
        function createNewFile() {
            const name = fileNameInput.value.trim();
            
            if (!name) {
                alert('Please enter a file name');
                return;
            }
            
            // Check if file already exists
            if (currentFolder.children.some(item => item.name === name && item.type === 'file')) {
                alert('A file with this name already exists');
                return;
            }
            
            const newFile = {
                id: 'file_' + Date.now(),
                name: name,
                type: 'file',
                parent: currentFolder,
                content: ''
            };
            
            currentFolder.children.push(newFile);
            fileModal.style.display = 'none';
            updateFileCount();
            renderFolderStructure();
            openFile(newFile);
            saveToLocalStorage();
        }

        // Open a file for editing
        function openFile(file) {
            currentFile = file;
            codeEditor.value = file.content;
            fileName.textContent = file.name;
            currentFileInfo.textContent = file.name;
            
            // Highlight active file in the file explorer
            document.querySelectorAll('.folder-structure li').forEach(li => {
                li.classList.remove('active');
                if (li.dataset.id === file.id) {
                    li.classList.add('active');
                }
            });
        }

        // Save the current file
        function saveCurrentFile() {
            if (!currentFile) {
                alert('No file selected');
                return;
            }
            
            currentFile.content = codeEditor.value;
            saveToLocalStorage();
        }

        // Delete the current file
        function deleteCurrentFile() {
            if (!currentFile) {
                alert('No file selected');
                return;
            }
            
            if (!confirm(`Are you sure you want to delete "${currentFile.name}"?`)) {
                return;
            }
            
            // Remove from parent's children
            const index = currentFolder.children.findIndex(child => child.id === currentFile.id);
            if (index !== -1) {
                currentFolder.children.splice(index, 1);
                
                // Clear the editor
                currentFile = null;
                codeEditor.value = '';
                fileName.textContent = 'No file selected';
                currentFileInfo.textContent = 'None';
                
                updateFileCount();
                renderFolderStructure();
                saveToLocalStorage();
            }
        }

        // Clear all files and folders
        function clearAllFiles() {
            if (!confirm('Are you sure you want to delete ALL files and folders? This cannot be undone.')) {
                return;
            }
            
            fileSystem.children = [];
            currentFolder = fileSystem;
            currentFile = null;
            codeEditor.value = '';
            fileName.textContent = 'No file selected';
            currentFileInfo.textContent = 'None';
            
            updateFileCount();
            renderFolderStructure();
            saveToLocalStorage();
        }

        // Count all files in the file system
        function countFiles(node = fileSystem) {
            let count = 0;
            
            if (node.type === 'file') {
                count = 1;
            } else if (node.children) {
                node.children.forEach(child => {
                    count += countFiles(child);
                });
            }
            
            return count;
        }

        // Update file count display
        function updateFileCount() {
            const count = countFiles();
            fileCountElement.textContent = count;
            totalFilesElement.textContent = count;
        }

        // Download all files as a zip
        function downloadAsZip() {
            const count = countFiles();
            if (count === 0) {
                alert('No files to download');
                return;
            }
            
            const zip = new JSZip();
            
            // Recursive function to add files and folders to zip
            function addToZip(folder, zipFolder) {
                folder.children.forEach(item => {
                    if (item.type === 'folder') {
                        const newFolder = zipFolder.folder(item.name);
                        addToZip(item, newFolder);
                    } else {
                        zipFolder.file(item.name, item.content);
                    }
                });
            }
            
            addToZip(fileSystem, zip);
            
            zip.generateAsync({type: 'blob'}).then(content => {
                saveAs(content, 'code_files.zip');
            });
        }

        // Show context menu
        function showContextMenu(x, y) {
            contextMenu.style.display = 'block';
            contextMenu.style.left = x + 'px';
            contextMenu.style.top = y + 'px';
        }

        // Hide context menu
        function hideContextMenu() {
            contextMenu.style.display = 'none';
        }

        // Rename an item
        function renameItem(target) {
            const id = target.dataset.id;
            const item = findItemById(fileSystem, id);
            
            if (!item) return;
            
            const newName = prompt(`Enter new name for ${item.name}:`, item.name);
            
            if (newName && newName.trim() !== '') {
                // Check if name already exists
                if (item.parent.children.some(child => 
                    child.id !== item.id && child.name === newName.trim())) {
                    alert('An item with this name already exists in this folder');
                    return;
                }
                
                item.name = newName.trim();
                renderFolderStructure();
                
                // If it's the current file, update the file name display
                if (currentFile && currentFile.id === item.id) {
                    fileName.textContent = item.name;
                    currentFileInfo.textContent = item.name;
                }
                
                saveToLocalStorage();
            }
        }

        // Delete an item
        function deleteItem(target) {
            const id = target.dataset.id;
            const item = findItemById(fileSystem, id);
            
            if (!item) return;
            
            if (!confirm(`Are you sure you want to delete "${item.name}"?`)) {
                return;
            }
            
            // Remove from parent's children
            const index = item.parent.children.findIndex(child => child.id === id);
            if (index !== -1) {
                item.parent.children.splice(index, 1);
                
                // If it's the current file, clear the editor
                if (currentFile && currentFile.id === id) {
                    currentFile = null;
                    codeEditor.value = '';
                    fileName.textContent = 'No file selected';
                    currentFileInfo.textContent = 'None';
                }
                
                updateFileCount();
                renderFolderStructure();
                saveToLocalStorage();
            }
        }

        // Helper function to find an item by ID
        function findItemById(root, id) {
            if (root.id === id) return root;
            
            if (root.children) {
                for (let child of root.children) {
                    const found = findItemById(child, id);
                    if (found) return found;
                }
            }
            
            return null;
        }

        // Initialize the app
        init();
    </script>
</body>
</html>
