<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Advanced Monthly Calendar</title>
  <style>
    :root {
      --primary-color: #2e7d32;
      --primary-light: #60ad5e;
      --primary-dark: #005005;
      --secondary-color: #f5f5f5;
      --accent-color: #ffc107;
      --text-color: #333;
      --light-text: #fff;
      --border-color: #ddd;
      --today-color: #ffeb3b;
      --friday-color: #ff5252;
      --saturday-color: #ff9800;
      --event-color: #4285f4;
      --hover-color: #e8f5e9;
      --season-spring: #e8f5e9;
      --season-summer: #fff3e0;
      --season-autumn: #fbe9e7;
      --season-winter: #e3f2fd;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
      color: var(--text-color);
      line-height: 1.6;
      padding: 20px;
      min-height: 100vh;
      transition: background 0.5s ease;
    }

    .container {
      max-width: 1000px;
      margin: 0 auto;
      background-color: white;
      border-radius: 12px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
      overflow: hidden;
    }

    header {
      background: linear-gradient(to right, var(--primary-color), var(--primary-light));
      color: var(--light-text);
      padding: 25px 20px;
      text-align: center;
      position: relative;
    }

    h1 {
      font-size: 2.5rem;
      margin-bottom: 10px;
      font-weight: 600;
    }

    .subtitle {
      font-size: 1.1rem;
      opacity: 0.9;
    }

    .country-info {
      position: absolute;
      top: 20px;
      right: 20px;
      background: rgba(255, 255, 255, 0.2);
      padding: 8px 15px;
      border-radius: 20px;
      font-size: 0.9rem;
    }

    .calendar-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 20px;
      background-color: var(--secondary-color);
    }

    .month-nav {
      display: flex;
      align-items: center;
      gap: 15px;
    }

    .nav-btn {
      background-color: var(--primary-color);
      color: white;
      border: none;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .nav-btn:hover {
      background-color: var(--primary-dark);
      transform: scale(1.1);
    }

    .current-month {
      font-size: 1.8rem;
      font-weight: 600;
      color: var(--primary-dark);
      min-width: 250px;
      text-align: center;
    }

    .controls {
      padding: 20px;
      background-color: var(--secondary-color);
      display: flex;
      flex-wrap: wrap;
      gap: 15px;
      align-items: center;
      justify-content: center;
      border-top: 1px solid var(--border-color);
    }

    .control-group {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    label {
      font-weight: 600;
      color: var(--primary-dark);
      font-size: 0.9rem;
    }

    select, input, button {
      padding: 10px 15px;
      border: 1px solid var(--border-color);
      border-radius: 6px;
      font-size: 1rem;
      transition: all 0.3s ease;
    }

    select:focus, input:focus {
      outline: none;
      border-color: var(--primary-color);
      box-shadow: 0 0 0 2px rgba(46, 125, 50, 0.2);
    }

    button {
      background-color: var(--primary-color);
      color: white;
      border: none;
      cursor: pointer;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    button:hover {
      background-color: var(--primary-dark);
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }

    button:active {
      transform: translateY(0);
    }

    .calendar-container {
      padding: 20px;
      transition: background 0.5s ease;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin: 0 auto;
    }

    th {
      background-color: var(--primary-light);
      color: white;
      padding: 15px 10px;
      font-weight: 600;
      font-size: 1rem;
    }

    td {
      border: 1px solid var(--border-color);
      padding: 15px 10px;
      text-align: center;
      transition: all 0.2s ease;
      position: relative;
      cursor: pointer;
      height: 100px;
      vertical-align: top;
      width: 14.28%;
    }

    td:hover {
      background-color: var(--hover-color);
    }

    /* Highlight today's date */
    td.today {
      background-color: var(--today-color);
      color: black;
      font-weight: bold;
      box-shadow: 0 0 0 2px var(--primary-color);
    }

    /* Friday style */
    td.friday {
      background-color: var(--friday-color);
      color: white;
    }

    /* Saturday style */
    td.saturday {
      background-color: var(--saturday-color);
      color: white;
    }

    /* Today on Friday (Gradient) */
    td.today.friday {
      background: linear-gradient(135deg, var(--friday-color) 0%, var(--today-color) 100%);
      color: black;
      font-weight: bold;
    }

    /* Today on Saturday (Gradient) */
    td.today.saturday {
      background: linear-gradient(135deg, var(--saturday-color) 0%, var(--today-color) 100%);
      color: black;
      font-weight: bold;
    }

    .empty-cell {
      background-color: #f9f9f9;
    }

    .event-indicator {
      position: absolute;
      bottom: 5px;
      left: 50%;
      transform: translateX(-50%);
      width: 8px;
      height: 8px;
      background-color: var(--event-color);
      border-radius: 50%;
    }

    .event-list {
      margin-top: 5px;
      font-size: 0.7rem;
      text-align: left;
      padding: 0 2px;
      max-height: 50px;
      overflow-y: auto;
    }

    .event-item {
      background-color: var(--event-color);
      color: white;
      border-radius: 3px;
      padding: 2px 5px;
      margin-bottom: 2px;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    .holiday-item {
      background-color: #ff6b6b;
    }

    .legend {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin-top: 20px;
      padding: 15px;
      background-color: var(--secondary-color);
      border-radius: 8px;
      flex-wrap: wrap;
    }

    .legend-item {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .legend-color {
      width: 20px;
      height: 20px;
      border-radius: 4px;
    }

    .today-legend {
      background-color: var(--today-color);
    }

    .friday-legend {
      background-color: var(--friday-color);
    }

    .saturday-legend {
      background-color: var(--saturday-color);
    }

    .today-friday-legend {
      background: linear-gradient(135deg, var(--friday-color) 0%, var(--today-color) 100%);
    }

    .today-saturday-legend {
      background: linear-gradient(135deg, var(--saturday-color) 0%, var(--today-color) 100%);
    }

    .event-legend {
      background-color: var(--event-color);
    }

    .holiday-legend {
      background-color: #ff6b6b;
    }

    .api-status {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 10px 15px;
      background-color: #e8f5e9;
      border-radius: 6px;
      margin-top: 10px;
    }

    .status-indicator {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      background-color: #4caf50;
      animation: pulse 2s infinite;
    }

    @keyframes pulse {
      0% { opacity: 1; }
      50% { opacity: 0.5; }
      100% { opacity: 1; }
    }

    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.5);
      z-index: 1000;
      align-items: center;
      justify-content: center;
    }

    .modal-content {
      background-color: white;
      padding: 30px;
      border-radius: 10px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
      max-width: 500px;
      width: 90%;
      text-align: center;
    }

    .modal h2 {
      margin-bottom: 20px;
      color: var(--primary-dark);
    }

    .country-select {
      width: 100%;
      padding: 12px;
      margin-bottom: 20px;
      border: 1px solid var(--border-color);
      border-radius: 6px;
      font-size: 1rem;
    }

    footer {
      text-align: center;
      padding: 20px;
      color: var(--text-color);
      font-size: 0.9rem;
      border-top: 1px solid var(--border-color);
      margin-top: 20px;
    }

    /* Seasonal backgrounds */
    .spring {
      background-color: var(--season-spring);
    }

    .summer {
      background-color: var(--season-summer);
    }

    .autumn {
      background-color: var(--season-autumn);
    }

    .winter {
      background-color: var(--season-winter);
    }

    @media (max-width: 768px) {
      .calendar-header {
        flex-direction: column;
        gap: 15px;
      }
      
      .controls {
        flex-direction: column;
        align-items: stretch;
      }
      
      .control-group {
        width: 100%;
      }
      
      td {
        height: 80px;
        padding: 10px 5px;
      }
      
      .event-list {
        max-height: 40px;
      }
    }
  </style>
</head>
<body>
  <div class="modal" id="countryModal">
    <div class="modal-content">
      <h2>Welcome to Advanced Calendar</h2>
      <p>Please select your country to load relevant holidays:</p>
      <select class="country-select" id="countrySelect">
        <option value="">Select a country</option>
        <option value="US">United States</option>
        <option value="GB">United Kingdom</option>
        <option value="CA">Canada</option>
        <option value="AU">Australia</option>
        <option value="IN">India</option>
        <option value="DE">Germany</option>
        <option value="FR">France</option>
        <option value="JP">Japan</option>
        <option value="BR">Brazil</option>
        <option value="ZA">South Africa</option>
        <option value="MX">Mexico</option>
        <option value="IT">Italy</option>
        <option value="ES">Spain</option>
        <option value="KR">South Korea</option>
        <option value="CN">China</option>
        <option value="RU">Russia</option>
      </select>
      <button onclick="saveCountry()">Save & Continue</button>
    </div>
  </div>

  <div class="container">
    <header>
      <h1>Advanced Monthly Calendar</h1>
      <div class="subtitle">With country-specific holidays and seasonal themes</div>
      <div class="country-info" id="countryInfo">Country: Not set</div>
    </header>
    
    <div class="calendar-header">
      <div class="month-nav">
        <button class="nav-btn" onclick="changeMonth(-1)">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
            <path fill-rule="evenodd" d="M11.354 1.646a.5.5 0 0 1 0 .708L5.707 8l5.647 5.646a.5.5 0 0 1-.708.708l-6-6a.5.5 0 0 1 0-.708l6-6a.5.5 0 0 1 .708 0z"/>
          </svg>
        </button>
        <div class="current-month" id="currentMonth">January 2023</div>
        <button class="nav-btn" onclick="changeMonth(1)">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
            <path fill-rule="evenodd" d="M4.646 1.646a.5.5 0 0 1 .708 0l6 6a.5.5 0 0 1 0 .708l-6 6a.5.5 0 0 1-.708-.708L10.293 8 4.646 2.354a.5.5 0 0 1 0-.708z"/>
          </svg>
        </button>
      </div>
      
      <button onclick="jumpToToday()">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
          <path d="M8 3.5a.5.5 0 0 0-1 0V9a.5.5 0 0 0 .252.434l3.5 2a.5.5 0 0 0 .496-.868L8 8.71V3.5z"/>
          <path d="M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16zm7-8A7 7 0 1 1 1 8a7 7 0 0 1 14 0z"/>
        </svg>
        Today
      </button>
    </div>
    
    <div class="controls">
      <div class="control-group">
        <label for="yearSelect">Select Year</label>
        <select id="yearSelect" onchange="updateCalendar()"></select>
      </div>
      
      <div class="control-group">
        <label for="monthSelect">Jump to Month</label>
        <select id="monthSelect" onchange="jumpToMonth()">
          <option value="0">January</option>
          <option value="1">February</option>
          <option value="2">March</option>
          <option value="3">April</option>
          <option value="4">May</option>
          <option value="5">June</option>
          <option value="6">July</option>
          <option value="7">August</option>
          <option value="8">September</option>
          <option value="9">October</option>
          <option value="10">November</option>
          <option value="11">December</option>
        </select>
      </div>
      
      <div class="control-group">
        <label for="countryChange">Change Country</label>
        <select id="countryChange" onchange="changeCountry()">
          <option value="US">United States</option>
          <option value="GB">United Kingdom</option>
          <option value="CA">Canada</option>
          <option value="AU">Australia</option>
          <option value="IN">India</option>
          <option value="DE">Germany</option>
          <option value="FR">France</option>
          <option value="JP">Japan</option>
          <option value="BR">Brazil</option>
          <option value="ZA">South Africa</option>
          <option value="MX">Mexico</option>
          <option value="IT">Italy</option>
          <option value="ES">Spain</option>
          <option value="KR">South Korea</option>
          <option value="CN">China</option>
          <option value="RU">Russia</option>
        </select>
      </div>
    </div>
    
    <div class="api-status">
      <div class="status-indicator"></div>
      <span>Google Calendar API: Active (Updates every 8 hours)</span>
    </div>
    
    <div class="calendar-container" id="calendarContainer">
      <table>
        <thead>
          <tr>
            <th>Sun</th>
            <th>Mon</th>
            <th>Tue</th>
            <th>Wed</th>
            <th>Thu</th>
            <th>Fri</th>
            <th>Sat</th>
          </tr>
        </thead>
        <tbody id="calendarBody">
          <!-- Calendar will be generated here -->
        </tbody>
      </table>
    </div>
    
    <div class="legend">
      <div class="legend-item">
        <div class="legend-color today-legend"></div>
        <span>Today</span>
      </div>
      <div class="legend-item">
        <div class="legend-color friday-legend"></div>
        <span>Friday (Holiday)</span>
      </div>
      <div class="legend-item">
        <div class="legend-color saturday-legend"></div>
        <span>Saturday (Holiday)</span>
      </div>
      <div class="legend-item">
        <div class="legend-color event-legend"></div>
        <span>Event</span>
      </div>
      <div class="legend-item">
        <div class="legend-color holiday-legend"></div>
        <span>Holiday</span>
      </div>
    </div>
    
    <footer>
      <p>Advanced Monthly Calendar &copy; 2023 | Friday and Saturday are highlighted as holidays</p>
    </footer>
  </div>

  <script>
    const today = new Date();
    let currentDate = new Date();
    let currentYear = today.getFullYear();
    let currentMonth = today.getMonth();
    let googleEvents = {};
    let updateInterval;
    let userCountry = localStorage.getItem('userCountry') || '';

    // Show country modal if not set
    if (!userCountry) {
      document.getElementById('countryModal').style.display = 'flex';
    } else {
      document.getElementById('countryInfo').textContent = `Country: ${getCountryName(userCountry)}`;
      document.getElementById('countryChange').value = userCountry;
    }

    // Initialize year options with default range 1800-2100
    const yearSelect = document.getElementById("yearSelect");
    function initializeYearSelector() {
      // Clear existing options
      yearSelect.innerHTML = '';
      
      // Add default years (1800-2100)
      for (let year = 1800; year <= 2100; year++) {
        const option = document.createElement("option");
        option.value = year;
        option.textContent = year;
        if (year === today.getFullYear()) option.selected = true;
        yearSelect.appendChild(option);
      }
    }
    
    initializeYearSelector();

    // Set current month in month selector
    document.getElementById("monthSelect").value = today.getMonth();

    // Function to get country name from code
    function getCountryName(countryCode) {
      const countryNames = {
        'US': 'United States',
        'GB': 'United Kingdom',
        'CA': 'Canada',
        'AU': 'Australia',
        'IN': 'India',
        'DE': 'Germany',
        'FR': 'France',
        'JP': 'Japan',
        'BR': 'Brazil',
        'ZA': 'South Africa',
        'MX': 'Mexico',
        'IT': 'Italy',
        'ES': 'Spain',
        'KR': 'South Korea',
        'CN': 'China',
        'RU': 'Russia'
      };
      return countryNames[countryCode] || countryCode;
    }

    // Save country selection
    function saveCountry() {
      const countrySelect = document.getElementById('countrySelect');
      userCountry = countrySelect.value;
      
      if (!userCountry) {
        alert('Please select a country');
        return;
      }
      
      localStorage.setItem('userCountry', userCountry);
      document.getElementById('countryModal').style.display = 'none';
      document.getElementById('countryInfo').textContent = `Country: ${getCountryName(userCountry)}`;
      document.getElementById('countryChange').value = userCountry;
      
      // Generate calendar with new country
      generateCalendar(currentYear, currentMonth);
    }

    // Change country
    function changeCountry() {
      userCountry = document.getElementById('countryChange').value;
      localStorage.setItem('userCountry', userCountry);
      document.getElementById('countryInfo').textContent = `Country: ${getCountryName(userCountry)}`;
      
      // Regenerate calendar with new country data
      generateCalendar(currentYear, currentMonth);
    }

    // Function to fetch events from Google Calendar API
    async function fetchGoogleCalendarEvents(year, month) {
      const API_KEY = 'AIzaSyA5ewt8gNixBDRh0MNZhNvQtaY0Rx6yjC4';
      // Using a public holidays calendar based on country
      const CALENDAR_ID = `${userCountry.toLowerCase()}.${userCountry.toLowerCase()}#holiday@group.v.calendar.google.com`;
      
      // Calculate time range for the month
      const timeMin = new Date(year, month, 1).toISOString();
      const timeMax = new Date(year, month + 1, 0).toISOString();
      
      try {
        const response = await fetch(
          `https://www.googleapis.com/calendar/v3/calendars/${encodeURIComponent(CALENDAR_ID)}/events?` +
          `key=${API_KEY}&timeMin=${timeMin}&timeMax=${timeMax}&singleEvents=true&orderBy=startTime`
        );
        
        if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status}`);
        }
        
        const data = await response.json();
        return data.items || [];
      } catch (error) {
        console.error('Error fetching Google Calendar events:', error);
        // Return mock data for demonstration
        return generateMockEvents(year, month);
      }
    }

    // Generate mock events for demonstration
    function generateMockEvents(year, month) {
      const events = [];
      const holidays = [
        { name: "New Year's Day", month: 0, day: 1 },
        { name: "Valentine's Day", month: 1, day: 14 },
        { name: "St. Patrick's Day", month: 2, day: 17 },
        { name: "April Fools' Day", month: 3, day: 1 },
        { name: "Earth Day", month: 3, day: 22 },
        { name: "Cinco de Mayo", month: 4, day: 5 },
        { name: "Mother's Day", month: 4, day: 14 }, // Second Sunday in May
        { name: "Memorial Day", month: 4, day: 29 }, // Last Monday in May
        { name: "Father's Day", month: 5, day: 18 }, // Third Sunday in June
        { name: "Independence Day", month: 6, day: 4 },
        { name: "Labor Day", month: 8, day: 4 }, // First Monday in September
        { name: "Halloween", month: 9, day: 31 },
        { name: "Veterans Day", month: 10, day: 11 },
        { name: "Thanksgiving", month: 10, day: 23 }, // Fourth Thursday in November
        { name: "Christmas Eve", month: 11, day: 24 },
        { name: "Christmas Day", month: 11, day: 25 },
        { name: "New Year's Eve", month: 11, day: 31 }
      ];

      holidays.forEach(holiday => {
        if (holiday.month === month) {
          const date = new Date(year, holiday.month, holiday.day);
          // Adjust for floating holidays
          if (holiday.name === "Mother's Day") {
            // Second Sunday in May
            date.setDate(1); // Start from first day of month
            while (date.getDay() !== 0 || date.getDate() <= 7) {
              date.setDate(date.getDate() + 1);
            }
            date.setDate(date.getDate() + 7); // Second Sunday
          } else if (holiday.name === "Memorial Day") {
            // Last Monday in May
            date.setDate(1);
            date.setMonth(5); // June
            date.setDate(0); // Last day of May
            while (date.getDay() !== 1) {
              date.setDate(date.getDate() - 1);
            }
          } else if (holiday.name === "Father's Day") {
            // Third Sunday in June
            date.setDate(1);
            while (date.getDay() !== 0 || date.getDate() <= 14) {
              date.setDate(date.getDate() + 1);
            }
            date.setDate(date.getDate() + 7); // Third Sunday
          } else if (holiday.name === "Labor Day") {
            // First Monday in September
            date.setDate(1);
            while (date.getDay() !== 1) {
              date.setDate(date.getDate() + 1);
            }
          } else if (holiday.name === "Thanksgiving") {
            // Fourth Thursday in November
            date.setDate(1);
            while (date.getDay() !== 4 || date.getDate() <= 21) {
              date.setDate(date.getDate() + 1);
            }
            date.setDate(date.getDate() + 21); // Fourth Thursday
          }

          events.push({
            summary: holiday.name,
            start: {
              date: date.toISOString().split('T')[0]
            }
          });
        }
      });

      // Add some random events
      for (let i = 0; i < 5; i++) {
        const day = Math.floor(Math.random() * 28) + 1;
        const eventTypes = ["Team Meeting", "Project Deadline", "Conference", "Birthday", "Appointment"];
        const randomEvent = eventTypes[Math.floor(Math.random() * eventTypes.length)];
        
        events.push({
          summary: randomEvent,
          start: {
            date: new Date(year, month, day).toISOString().split('T')[0]
          }
        });
      }

      return events;
    }

    // Process events and store by date
    function processEvents(events) {
      const eventsByDate = {};
      
      events.forEach(event => {
        const dateStr = event.start.date || event.start.dateTime.split('T')[0];
        if (!eventsByDate[dateStr]) {
          eventsByDate[dateStr] = [];
        }
        eventsByDate[dateStr].push({
          name: event.summary,
          isHoliday: event.summary.toLowerCase().includes('day') && 
                    !event.summary.toLowerCase().includes('meeting') &&
                    !event.summary.toLowerCase().includes('deadline') &&
                    !event.summary.toLowerCase().includes('conference') &&
                    !event.summary.toLowerCase().includes('appointment')
        });
      });
      
      return eventsByDate;
    }

    // Get season based on month
    function getSeason(month) {
      if (month >= 2 && month <= 4) return 'spring';
      if (month >= 5 && month <= 7) return 'summer';
      if (month >= 8 && month <= 10) return 'autumn';
      return 'winter';
    }

    // Apply seasonal theme
    function applySeasonalTheme(month) {
      const season = getSeason(month);
      const calendarContainer = document.getElementById('calendarContainer');
      
      // Remove all season classes
      calendarContainer.classList.remove('spring', 'summer', 'autumn', 'winter');
      
      // Add current season class
      calendarContainer.classList.add(season);
    }

    // Generate calendar for a specific month
    async function generateCalendar(year, month) {
      const calendarBody = document.getElementById("calendarBody");
      calendarBody.innerHTML = ""; // Clear previous calendar

      // Update current date
      currentDate = new Date(year, month, 1);
      currentYear = year;
      currentMonth = month;

      // Update month and year selectors
      yearSelect.value = year;
      document.getElementById("monthSelect").value = month;

      // Update current month display
      const monthNames = [
        "January", "February", "March", "April", "May", "June",
        "July", "August", "September", "October", "November", "December"
      ];
      document.getElementById("currentMonth").textContent = `${monthNames[month]} ${year}`;

      // Apply seasonal theme
      applySeasonalTheme(month);

      // Fetch events from Google Calendar if country is set
      if (userCountry) {
        const events = await fetchGoogleCalendarEvents(year, month);
        googleEvents = processEvents(events);
      }

      const firstDay = new Date(year, month, 1).getDay();
      const daysInMonth = new Date(year, month + 1, 0).getDate();

      let row = document.createElement("tr");
      
      // Add empty cells for days before the first day of the month
      for (let i = 0; i < firstDay; i++) {
        const emptyCell = document.createElement("td");
        emptyCell.className = "empty-cell";
        row.appendChild(emptyCell);
      }

      for (let day = 1; day <= daysInMonth; day++) {
        const cell = document.createElement("td");
        cell.innerHTML = `<div class="day-number">${day}</div>`;
        const dateStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
        cell.setAttribute("data-date", dateStr);

        // Check if it's today
        const isToday = 
          year === today.getFullYear() &&
          month === today.getMonth() &&
          day === today.getDate();

        // Check if it's Friday (5) or Saturday (6)
        const dayOfWeek = new Date(year, month, day).getDay();
        const isFriday = dayOfWeek === 5;
        const isSaturday = dayOfWeek === 6;

        // Apply appropriate classes
        if (isToday) {
          cell.classList.add("today");
        }
        if (isFriday) {
          cell.classList.add("friday");
        }
        if (isSaturday) {
          cell.classList.add("saturday");
        }

        // Add Google Calendar events if any
        if (googleEvents[dateStr]) {
          const eventList = document.createElement("div");
          eventList.className = "event-list";
          
          // Show events
          googleEvents[dateStr].forEach(event => {
            const eventItem = document.createElement("div");
            eventItem.className = event.isHoliday ? "event-item holiday-item" : "event-item";
            eventItem.textContent = event.name;
            eventList.appendChild(eventItem);
          });
          
          cell.appendChild(eventList);
          
          // Add event indicator dot
          const eventIndicator = document.createElement("div");
          eventIndicator.className = "event-indicator";
          cell.appendChild(eventIndicator);
        }

        // Add click event to select date
        cell.addEventListener("click", function() {
          selectDate(this.getAttribute("data-date"));
        });

        row.appendChild(cell);

        // Start a new row after Saturday
        if ((firstDay + day) % 7 === 0) {
          calendarBody.appendChild(row);
          row = document.createElement("tr");
        }
      }

      // Add empty cells for remaining days in the last week
      if (row.children.length > 0) {
        const remainingCells = 7 - row.children.length;
        for (let i = 0; i < remainingCells; i++) {
          const emptyCell = document.createElement("td");
          emptyCell.className = "empty-cell";
          row.appendChild(emptyCell);
        }
        calendarBody.appendChild(row);
      }
    }

    function updateCalendar() {
      currentYear = parseInt(yearSelect.value);
      generateCalendar(currentYear, currentMonth);
    }

    function jumpToMonth() {
      const selectedMonth = parseInt(document.getElementById("monthSelect").value);
      currentMonth = selectedMonth;
      generateCalendar(currentYear, currentMonth);
    }

    function changeMonth(direction) {
      currentMonth += direction;
      
      // Handle year boundaries
      if (currentMonth < 0) {
        currentMonth = 11;
        currentYear--;
      } else if (currentMonth > 11) {
        currentMonth = 0;
        currentYear++;
      }
      
      generateCalendar(currentYear, currentMonth);
    }

    function jumpToToday() {
      currentYear = today.getFullYear();
      currentMonth = today.getMonth();
      generateCalendar(currentYear, currentMonth);
    }

    function selectDate(dateString) {
      const dateParts = dateString.split("-");
      const year = parseInt(dateParts[0]);
      const month = parseInt(dateParts[1]) - 1;
      const day = parseInt(dateParts[2]);
      
      const selectedDate = new Date(year, month, day);
      const options = { year: 'numeric', month: 'long', day: 'numeric', weekday: 'long' };
      
      let eventInfo = "";
      if (googleEvents[dateString]) {
        eventInfo = `\n\nEvents on this day:\n${googleEvents[dateString].map(e => e.name).join('\n')}`;
      }
      
      alert(`You selected: ${selectedDate.toLocaleDateString('en-US', options)}${eventInfo}`);
    }

    // Set up automatic updates every 8 hours (3 times a day)
    function setupAutoUpdates() {
      // Clear any existing interval
      if (updateInterval) {
        clearInterval(updateInterval);
      }
      
      // Update every 8 hours (28,800,000 milliseconds)
      updateInterval = setInterval(() => {
        console.log("Auto-updating calendar data...");
        generateCalendar(currentYear, currentMonth);
      }, 28800000); // 8 hours in milliseconds
    }

    // Generate the initial calendar if country is set
    if (userCountry) {
      generateCalendar(today.getFullYear(), today.getMonth());
      setupAutoUpdates();
    }
  </script>
</body>
</html>
